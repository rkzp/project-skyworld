[gd_resource type="ShaderMaterial" load_steps=6 format=3 uid="uid://bndx8pjxheac5"]

[sub_resource type="Shader" id="Shader_11bip"]
code = "shader_type fog;

uniform float base_cloud_height = 500.0;
uniform float max_aboveheight = 20.0;
uniform float max_belowheight = 2.0;
uniform float density = 1.0;
uniform float base_size = 5000.0;
uniform float secondary_size = 1000.0;
uniform float density_threshold = 0.1;
uniform sampler2D noise_base: hint_default_black, repeat_enable;
uniform float detail_size = 1000.0;
uniform sampler2D noise_detail: hint_default_black, repeat_enable;
uniform vec2 cloud_motion = vec2(1.5, -1.5);

void fog() {
	vec3 sample_pos = WORLD_POSITION;
	sample_pos.y -= base_cloud_height;
	sample_pos.xz += cloud_motion * TIME;
	float base_noise = texture(noise_base, sample_pos.zx / base_size).r;
	base_noise *= texture(noise_base, sample_pos.xz / secondary_size).r;
	float detail_noise = texture(noise_detail, sample_pos.xz / detail_size).r;
	float height = sample_pos.y < 0.0? -max_belowheight:max_aboveheight;
	height = mix(0.0, height, pow(base_noise, 0.5));
	height = clamp(smoothstep(height, 0.0, sample_pos.y), 0.0, 1.0);
	DENSITY = (base_noise - density_threshold);
	DENSITY *= height;
	DENSITY *= detail_noise;
	DENSITY *= pow(1.0 - UVW.z, 2.0);
	DENSITY *= density;
	ALBEDO = vec3(0.7);
}
"

[sub_resource type="FastNoiseLite" id="FastNoiseLite_tedo3"]
noise_type = 2
cellular_jitter = 1.0

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_rwvfo"]
width = 1024
height = 1024
invert = true
seamless = true
noise = SubResource("FastNoiseLite_tedo3")

[sub_resource type="FastNoiseLite" id="FastNoiseLite_yrh1g"]
noise_type = 2
frequency = 0.02
fractal_type = 2
cellular_distance_function = 3
cellular_jitter = 1.0
domain_warp_enabled = true
domain_warp_type = 1

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_tqmj8"]
noise = SubResource("FastNoiseLite_yrh1g")

[resource]
shader = SubResource("Shader_11bip")
shader_parameter/base_cloud_height = 500.0
shader_parameter/max_aboveheight = 50.0
shader_parameter/max_belowheight = 2.0
shader_parameter/density = 0.2
shader_parameter/base_size = 10000.0
shader_parameter/secondary_size = 2000.0
shader_parameter/density_threshold = 0.2
shader_parameter/detail_size = 1000.0
shader_parameter/cloud_motion = Vector2(1.5, -1.5)
shader_parameter/noise_base = SubResource("NoiseTexture2D_rwvfo")
shader_parameter/noise_detail = SubResource("NoiseTexture2D_tqmj8")
